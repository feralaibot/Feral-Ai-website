// Google Apps Script â€” handles POSTed JSON and logs to a Sheet
function doPost(e){
  var ss = SpreadsheetApp.openById('PUT_YOUR_SHEET_ID_HERE'); // <-- set this
  var sheet = ss.getSheetByName('Scores') || ss.insertSheet('Scores');

  // Ensure header row
  if (sheet.getLastRow() === 0) {
    sheet.appendRow(['Timestamp (server)', 'Name/Handle', 'Score', 'Client TS', 'UserAgent']);
  }

  var body = e && e.postData ? e.postData.contents : '{}';
  var data;
  try {
    data = JSON.parse(body);
  } catch (err) {
    data = {};
  }

  sheet.appendRow([
    new Date(),                     // server timestamp
    data.name || '',                // name/handle
    Number(data.score) || 0,        // score
    data.ts || '',                  // client-side ISO timestamp
    data.ua || ''                   // user agent snippet
  ]);

  return ContentService
    .createTextOutput('ok')
    .setMimeType(ContentService.MimeType.TEXT);
}
